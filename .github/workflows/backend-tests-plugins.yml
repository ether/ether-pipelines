name: Backend Tests

# any branch is useful for testing before a PR is submitted
on:
  workflow_call:

jobs:
  withplugins:
    # run on pushes to any branch
    # run on PRs from external forks
    if: |
      (github.event_name != 'pull_request')
      || (github.event.pull_request.head.repo.id != github.event.pull_request.base.repo.id)
    name: with Plugins
    runs-on: ubuntu-latest
    steps:
      - name: Setup etherpad
        uses: ./.github/workflows/setup-etherpad-with-plugins.yml
      - name: Run the backend tests
        run: |
          res=$(find .. -path "./node_modules/ep_*/static/tests/backend/specs/**" | wc -l)
          if [ $res -eq 0 ]; then
          echo "No backend tests found"
          else
          pnpm run test
          fi
